---
import type {HTMLAttributes} from 'astro/types';
import {cardContainerClasses, BULLET_SEPARATOR} from '../utils/card-styles';
import {BADGE_BASE_CLASSES, CERTIFICATION_BADGE_COLORS, CERTIFICATION_CATEGORY_LABELS} from '../utils/badge';
import {cn} from '../utils/cn';
import ExternalLink from './ExternalLink.astro';

/**
 * CertificationCard displays a single certification with issuer details.
 * Follows project card styling patterns with dark mode support.
 *
 * Uses utilities:
 * - cardContainerClasses() for consistent card styling
 * - CERTIFICATION_BADGE_COLORS for category badge colors
 * - BADGE_BASE_CLASSES for badge styling
 * - BULLET_SEPARATOR for accessible metadata separator
 *
 * @example
 * ```astro
 * <CertificationCard
 *   name="Azure Certified Solution Architect Expert"
 *   issuer="Microsoft"
 *   year={2023}
 *   category="cloud"
 * />
 * ```
 */
interface Props extends HTMLAttributes<'article'> {
  /** Certification name */
  name: string;
  /** Issuing organization */
  issuer: string;
  /** Year obtained */
  year: number;
  /** Certification category */
  category: 'cloud' | 'data' | 'database' | 'other';
  /** Optional verification URL */
  verificationUrl?: string;
}

const {
  name,
  issuer,
  year,
  category,
  verificationUrl,
  class: className,
  ...attrs
} = Astro.props;
---

<article
  class={cardContainerClasses(cn('certification-card group', className))}
  data-testid="certification-card"
  {...attrs}
>
  <div class="flex flex-col gap-3">
    <!-- Category Badge -->
    <div>
      <span
        class={cn(BADGE_BASE_CLASSES, CERTIFICATION_BADGE_COLORS[category])}
        data-testid="category-badge"
      >
        {CERTIFICATION_CATEGORY_LABELS[category]}
      </span>
    </div>

    <!-- Certification Name -->
    <h3 class="text-lg font-semibold text-text dark:text-text-dark">
      {name}
    </h3>

    <!-- Issuer and Year -->
    <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-text-secondary dark:text-text-secondary-dark">
      <span class="font-medium">{issuer}</span>
      <Fragment set:html={BULLET_SEPARATOR} />
      <span>{year}</span>
    </div>

    <!-- Verification Link (if available) -->
    {
      verificationUrl && (
        <ExternalLink
          href={verificationUrl}
          variant="card-action"
          size="sm"
          ariaLabel={`Verify ${name} credential`}
          class="min-h-11 w-fit"
        >
          Verify Credential
        </ExternalLink>
      )
    }
  </div>
</article>
