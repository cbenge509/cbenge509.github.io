---
import {PROFILE_DATA} from '../data/profile';

/**
 * SEO component for managing page metadata, Open Graph, Twitter cards, and JSON-LD
 * Handles all SEO-related meta tags in one place
 * @example
 * ```astro
 * ---
 * import SEO from '../components/SEO.astro';
 * ---
 * <head>
 *   <SEO
 *     title="Projects"
 *     description="Portfolio projects by Cris Benge"
 *     includePersonSchema={false}
 *   />
 * </head>
 * ```
 */
interface Props {
  title: string;
  description: string;
  image?: string;
  canonical?: string;
  noIndex?: boolean;
  includePersonSchema?: boolean;
}

const {
  title,
  description,
  image = '/og-default.png',
  canonical,
  noIndex = false,
  includePersonSchema = false,
} = Astro.props;

// Site configuration from centralized profile data
const siteUrl = import.meta.env.SITE || PROFILE_DATA.siteUrl;
const siteName = PROFILE_DATA.name;

// Computed values
const fullTitle = `${title} | ${siteName}`;
const ogImage = image.startsWith('http') ? image : `${siteUrl}${image}`;
// Use site config + pathname for canonical URL (not Astro.url.href which uses localhost in dev)
const canonicalUrl = canonical || `${siteUrl}${Astro.url.pathname}`;

// JSON-LD Person schema for the home page (built from centralized profile data)
const personSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: PROFILE_DATA.name,
  jobTitle: PROFILE_DATA.jobTitle,
  worksFor: {
    '@type': 'Organization',
    name: PROFILE_DATA.employer,
  },
  url: siteUrl,
  sameAs: PROFILE_DATA.socialProfiles,
  alumniOf: PROFILE_DATA.education.map((edu) => ({
    '@type': 'CollegeOrUniversity',
    name: edu.name,
  })),
};
---

<!-- Page Title -->
<title>{fullTitle}</title>

<!-- Primary Meta Tags -->
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website" />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImage} />
<meta property="og:site_name" content={siteName} />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@cbaborern" />
<meta name="twitter:creator" content="@cbaborern" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<!-- Robots -->
{noIndex && <meta name="robots" content="noindex,nofollow" />}

<!-- JSON-LD Person Schema (home page only) -->
{
  includePersonSchema && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify(personSchema)}
    />
  )
}
