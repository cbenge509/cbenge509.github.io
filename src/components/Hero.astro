---
import type {HTMLAttributes} from 'astro/types';
import {Image} from 'astro:assets';
import profileImage from '../assets/images/profile/portfolio_image.jpg';
import {getSocialLink, HERO_PROFILE} from '../data/profile';
import ExternalLink from './ExternalLink.astro';

/**
 * Hero section component displaying professional identity with profile image
 * Features signature animation sequence on page load (UX-10 NON-NEGOTIABLE)
 * Two-column layout: profile image (left) + content (right) on desktop
 * Single-column layout: image above text on mobile
 *
 * @slot default - Not used (content is hardcoded for portfolio consistency)
 * @example
 * ```astro
 * <Hero />
 * ```
 * @example
 * ```astro
 * <Hero class="mt-20" showImage={false} />
 * ```
 */
interface Props extends HTMLAttributes<'section'> {
  /** Optional class name for additional styling */
  class?: string;
  /** Whether to show the profile image (defaults to true) */
  showImage?: boolean;
}

const {class: className, showImage = true, ...attrs} = Astro.props;

// Profile data from centralized source
const profile = HERO_PROFILE;
---

<section
  aria-labelledby="hero-heading"
  class:list={[
    'py-16 md:py-20 lg:py-24',
    'px-6 md:px-8',
    'bg-bg dark:bg-bg-dark',
    className,
  ]}
  {...attrs}
>
  <div class="max-w-5xl mx-auto">
    <!-- Two-column layout: image (left) + content (right) on desktop -->
    <div class:list={[
      'flex flex-col md:flex-row items-center gap-8 md:gap-12',
      showImage ? '' : 'md:max-w-4xl',
    ]}>
      <!-- Profile Image Column -->
      {showImage && (
        <div
          class="w-48 md:w-64 lg:w-80 flex-shrink-0 hero-animate-image"
          data-testid="hero-image-container"
        >
          <Image
            src={profileImage}
            alt="Cris Benge - Head of Federal Innovation at Google"
            widths={[200, 400, 600]}
            sizes="(max-width: 768px) 192px, (max-width: 1024px) 256px, 320px"
            formats={['avif', 'webp']}
            loading="eager"
            fetchpriority="high"
            class="w-full h-auto rounded-2xl shadow-lg"
            data-testid="hero-image"
          />
        </div>
      )}

      <!-- Content Column -->
      <div class="flex-1 text-center md:text-left">
        <!-- Name - h1 with signature animation -->
        <h1
          id="hero-heading"
          class="text-display-lg text-text dark:text-text-dark hero-animate-name"
          data-testid="hero-name"
        >
          {profile.name}
        </h1>

        <!-- Role - subtitle with staggered animation -->
        <p
          class="mt-2 font-display text-xl md:text-2xl font-semibold text-text-secondary dark:text-text-secondary-dark hero-animate-role"
          data-testid="hero-role"
        >
          {profile.role}
        </p>

        <!-- Credential badges -->
        <div
          class="mt-6 flex flex-wrap justify-center md:justify-start gap-3"
          data-testid="hero-credentials"
        >
          {
            profile.credentials.map((cred, index) => (
              <span
                class:list={[
                  'inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium hero-animate-credential',
                  cred.type === 'education'
                    ? 'bg-surface text-text dark:bg-surface-dark dark:text-text-dark'
                    : 'bg-accent/5 text-accent-hover dark:bg-accent-dark/15 dark:text-accent-dark',
                ]}
                style={`animation-delay: ${500 + index * 150}ms`}
                data-testid={`hero-credential-${index}`}
              >
                {cred.label}
              </span>
            ))
          }
        </div>

        <!-- CTA buttons -->
        <div
          class="mt-8 flex flex-col md:flex-row justify-center md:justify-start gap-4 hero-animate-ctas"
          data-testid="hero-ctas"
        >
          <!-- Primary CTA - LinkedIn -->
          <ExternalLink
            href={getSocialLink('LinkedIn').href}
            variant="button"
            colorScheme="accent"
            ariaLabel="Connect on LinkedIn"
            class="w-full md:w-auto"
            data-testid="hero-linkedin"
          >
            LinkedIn
          </ExternalLink>

          <!-- Secondary CTA - GitHub -->
          <ExternalLink
            href={getSocialLink('GitHub').href}
            variant="button-outlined"
            ariaLabel="View GitHub profile"
            class="w-full md:w-auto border-2 border-accent text-accent hover:bg-accent hover:text-white dark:border-accent-dark dark:text-accent-dark dark:hover:bg-accent-dark dark:hover:text-white"
            data-testid="hero-github"
          >
            GitHub
          </ExternalLink>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* =============================================================================
     HERO SIGNATURE ANIMATION - UX-10 (NON-NEGOTIABLE)
     ==============================================================================
     GPU-accelerated animations using transform + opacity only.
     Animation sequence (updated for profile image):
     - Profile image: 0-300ms (fade in first)
     - Name: 100-500ms (overlaps with image end)
     - Role: 300-600ms
     - Credentials: 500-900ms (staggered)
     - CTAs: 700-1100ms
     Total: ~1.2 seconds
     ============================================================================= */

  @keyframes hero-fade-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes hero-fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Profile image - first to animate (0-300ms) */
  .hero-animate-image {
    opacity: 0;
    animation: hero-fade-in 300ms var(--ease-out) forwards;
  }

  /* Name - overlaps with image end (100-500ms) */
  .hero-animate-name {
    opacity: 0;
    animation: hero-fade-up 400ms var(--ease-out) 100ms forwards;
  }

  /* Role - follows name (300-600ms) */
  .hero-animate-role {
    opacity: 0;
    animation: hero-fade-up 300ms var(--ease-out) 300ms forwards;
  }

  /* Credentials - staggered animation (500-850ms based on index) */
  .hero-animate-credential {
    opacity: 0;
    animation: hero-fade-up 300ms var(--ease-out) forwards;
    /* animation-delay is set inline per badge: 500ms, 650ms, 800ms */
  }

  /* CTAs - final element (700-1100ms) */
  .hero-animate-ctas {
    opacity: 0;
    animation: hero-fade-up 400ms var(--ease-out) 700ms forwards;
  }

  /* =============================================================================
     REDUCED MOTION SUPPORT - AC3
     ==============================================================================
     When user prefers reduced motion:
     - All content appears immediately (no transform animations)
     - Opacity transitions ARE allowed (not jarring per UX spec)
     - Uses 150ms opacity for subtle fade
     ============================================================================= */

  @media (prefers-reduced-motion: reduce) {
    .hero-animate-image,
    .hero-animate-name,
    .hero-animate-role,
    .hero-animate-credential,
    .hero-animate-ctas {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
</style>
