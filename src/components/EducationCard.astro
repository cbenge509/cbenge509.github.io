---
import type {HTMLAttributes} from 'astro/types';
import {Image} from 'astro:assets';
import {cardContainerClasses} from '../utils/card-styles';
import {BADGE_BASE_CLASSES} from '../utils/badge';
import {cn} from '../utils/cn';
import ExternalLink from './ExternalLink.astro';

/**
 * EducationCard displays a single education entry with institution details.
 * Follows project card styling patterns with dark mode support.
 *
 * Uses utilities:
 * - cardContainerClasses() for consistent card styling
 * - BADGE_BASE_CLASSES for honor badge styling
 *
 * @example
 * ```astro
 * <EducationCard
 *   institution="Columbia University"
 *   degree="M.S."
 *   field="Applied Analytics"
 *   year={2020}
 *   logoImage={columbiaLogo}
 *   institutionUrl="https://www.columbia.edu"
 * />
 * ```
 */
interface Props extends HTMLAttributes<'article'> {
  /** Name of the institution */
  institution: string;
  /** Degree type (e.g., M.S., B.S., MIDS) */
  degree: string;
  /** Field of study */
  field: string;
  /** Graduation year */
  year: number;
  /** Logo image (imported image object) */
  logoImage: ImageMetadata;
  /** Optional URL to institution website */
  institutionUrl?: string;
  /** Optional list of honors/distinctions */
  honors?: string[];
}

const {
  institution,
  degree,
  field,
  year,
  logoImage,
  institutionUrl,
  honors = [],
  class: className,
  ...attrs
} = Astro.props;
---

<article
  class={cardContainerClasses(cn('education-card group', className))}
  {...attrs}
>
  <div class="flex items-start gap-4">
    <!-- Institution Logo -->
    <div class="flex-shrink-0">
      <Image
        src={logoImage}
        alt={`${institution} logo`}
        width={64}
        height={64}
        class="rounded-lg"
      />
    </div>

    <!-- Education Details -->
    <div class="flex-1 min-w-0">
      <!-- Institution Name (with external link if URL provided) -->
      {
        institutionUrl ? (
          <ExternalLink
            href={institutionUrl}
            variant="text"
            ariaLabel={`${institution} website`}
            class="min-h-11 text-lg font-semibold"
          >
            {institution}
          </ExternalLink>
        ) : (
          <h3 class="text-lg font-semibold text-text dark:text-text-dark">
            {institution}
          </h3>
        )
      }

      <!-- Degree and Field -->
      <p class="mt-1 text-text-secondary dark:text-text-secondary-dark">
        <span class="font-medium">{degree}</span> in <span>{field}</span>
      </p>

      <!-- Year -->
      <p class="mt-1 text-sm text-text-secondary dark:text-text-secondary-dark">
        {year}
      </p>

      <!-- Honors (if any) -->
      {
        honors.length > 0 && (
          <ul class="mt-2 flex flex-wrap gap-2">
            {honors.map((honor) => (
              <li class={cn(BADGE_BASE_CLASSES, 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-200')}>
                {honor}
              </li>
            ))}
          </ul>
        )
      }
    </div>
  </div>
</article>
