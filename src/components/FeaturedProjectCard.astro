---
import type {HTMLAttributes} from 'astro/types';
import ProjectTag from './ProjectTag.astro';
import ProjectImage from './ProjectImage.astro';
import ExternalLink from './ExternalLink.astro';
import {CATEGORY_TO_VARIANT, CATEGORY_LABELS, type ProjectData} from '../utils/project-categories';
import {interactiveCardClasses} from '../utils/card-styles';
import {cn} from '../utils/cn';

/**
 * Featured Project Card component for displaying highlighted projects
 * Displays full 16:9 image, title, description, tags, and optional GitHub link
 *
 * Uses utilities:
 * - CATEGORY_TO_VARIANT for mapping categories to tag variants
 * - CATEGORY_LABELS for display labels
 * - ProjectImage for consistent image rendering
 * - Global line-clamp utilities for text truncation
 *
 * @example
 * ```astro
 * ---
 * const project = await getEntry('projects', 'ml-pipeline');
 * ---
 * <FeaturedProjectCard
 *   project={project.data}
 *   slug={project.slug}
 * />
 * ```
 */
export interface Props extends HTMLAttributes<'article'> {
  /** Project data from content collection */
  project: ProjectData;
  /** Project slug for linking to detail page */
  slug: string;
}

const {project, slug, class: className, ...attrs} = Astro.props;
---

<article
  data-component="featured-project-card"
  class={interactiveCardClasses(cn('group relative block', className))}
  {...attrs}
>
  <a
    href={`/projects/${slug}`}
    class="block focus:outline-none"
    aria-labelledby={`project-title-${slug}`}
  >
    <!-- Image container with 16:9 aspect ratio -->
    <ProjectImage
      image={project.image}
      alt={`Screenshot of ${project.title} project`}
      variant="featured"
    />

    <!-- Content -->
    <div class="p-4 md:p-6">
      <!-- Title -->
      <h3
        id={`project-title-${slug}`}
        class="font-display text-lg md:text-xl font-semibold text-text dark:text-text-dark line-clamp-1"
      >
        {project.title}
      </h3>

      <!-- Description - 2-3 lines with truncation -->
      <p
        class="mt-2 text-body text-text-secondary dark:text-text-secondary-dark line-clamp-3"
      >
        {project.description}
      </p>

      <!-- Tags and GitHub link row -->
      <div class="mt-4 flex flex-wrap items-center gap-2">
        <!-- Primary category tag -->
        <ProjectTag variant={CATEGORY_TO_VARIANT[project.category]}>
          {CATEGORY_LABELS[project.category]}
        </ProjectTag>

        <!-- Achievement tag if winner -->
        {
          project.achievement && project.category === 'winner' && (
            <span class="text-xs text-text-secondary dark:text-text-secondary-dark">
              {project.achievement}
            </span>
          )
        }
      </div>
    </div>
  </a>

  <!-- GitHub link (outside main link for separate interaction) -->
  {
    project.githubUrl && (
      <div class="absolute top-4 right-4">
        <ExternalLink
          href={project.githubUrl}
          variant="badge"
          size="xs"
          ariaLabel={`View ${project.title} on GitHub`}
          class="min-h-11"
          data-github-link
        >
          GitHub
        </ExternalLink>
      </div>
    )
  }
</article>

<script>
  import '../scripts/featured-project-card';
</script>
