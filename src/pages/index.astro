---
import {getCollection} from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import SectionHeading from '../components/SectionHeading.astro';
import FeaturedProjectCard from '../components/FeaturedProjectCard.astro';

// Get featured projects, sorted by order, limited to 3
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter((project) => project.data.isFeatured)
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999))
  .slice(0, 3);
---

<BaseLayout
  title="Home"
  description="Cris Benge - Head of Federal Innovation at Google. Leader, Data Scientist, and AI Researcher."
  includePersonSchema={true}
>
  <!-- Hero section with signature animation and profile image -->
  <Hero class="pt-24 md:pt-28" />

  <!-- Featured Projects Section - only show if there are featured projects -->
  {featuredProjects.length > 0 && (
    <section
      class="py-16 md:py-20 px-6 md:px-8 bg-bg dark:bg-bg-dark"
      aria-labelledby="featured-projects-heading"
      data-testid="featured-projects-section"
    >
      <div class="max-w-5xl mx-auto">
        <SectionHeading id="featured-projects-heading">
          Featured Projects
        </SectionHeading>

        <!-- Project cards grid -->
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"
          data-testid="featured-projects-grid"
        >
          {featuredProjects.map((project, index) => (
            <div data-reveal style={`transition-delay: ${index * 100}ms`}>
              <FeaturedProjectCard
                project={project.data}
                slug={project.slug}
                data-testid={`featured-project-${index}`}
              />
            </div>
          ))}
        </div>

        <!-- View All Projects link -->
        <div class="mt-10 text-center" data-reveal style="transition-delay: 300ms">
          <a
            href="/projects"
            class="inline-flex items-center gap-2 text-accent dark:text-accent-dark hover:text-accent-hover dark:hover:text-accent-hover-dark font-medium transition-colors duration-150 focus-ring rounded-lg px-2 py-1 -mx-2 -my-1 min-h-11"
            data-testid="view-all-projects-link"
          >
            View All Projects
            <span aria-hidden="true" class="text-lg">â†’</span>
          </a>
        </div>
      </div>
    </section>
  )}
</BaseLayout>

<script>
  // Import scroll-reveal functionality
  import '../scripts/scroll-reveal.ts';
</script>
