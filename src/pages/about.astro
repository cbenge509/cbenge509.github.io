---
import {getCollection} from 'astro:content';
import {Image} from 'astro:assets';
import BaseLayout from '../layouts/BaseLayout.astro';
import SectionHeading from '../components/SectionHeading.astro';
import EducationCard from '../components/EducationCard.astro';
import CertificationCard from '../components/CertificationCard.astro';
import AwardCard from '../components/AwardCard.astro';
import ContactSection from '../components/ContactSection.astro';
import profileImage from '../assets/images/profile/portfolio_image.jpg';

/**
 * About Page
 * Displays professional bio and education credentials
 *
 * @route /about
 */

// Fetch education from content collection
const educationEntries = await getCollection('education');
const sortedEducation = educationEntries.sort(
  (a, b) => a.data.order - b.data.order
);

// Fetch certifications from content collection
const certificationEntries = await getCollection('certifications');
const sortedCertifications = certificationEntries.sort(
  (a, b) => a.data.order - b.data.order
);

// Fetch awards from content collection
const awardEntries = await getCollection('awards');
const sortedAwards = awardEntries.sort((a, b) => a.data.order - b.data.order);

// Separate competition and professional awards
const competitionAwards = sortedAwards.filter(
  (award) => award.data.category === 'competition'
);
const professionalAwards = sortedAwards.filter(
  (award) => award.data.category === 'professional'
);

const hasEducation = sortedEducation.length > 0;
const hasCertifications = sortedCertifications.length > 0;
const hasAwards = sortedAwards.length > 0;
---

<BaseLayout
  title="About"
  description="Learn about Cris Benge - Head of Federal Innovation at Google, AI researcher, and graduate of Columbia University and UC Berkeley."
>
  <div class="container-custom py-16 md:py-24">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="Breadcrumb" class="mb-8">
      <ol class="flex items-center gap-2 text-sm text-text-secondary dark:text-text-secondary-dark">
        <li>
          <a
            href="/"
            class="min-h-11 inline-flex items-center hover:text-accent dark:hover:text-accent-dark transition-colors duration-150 focus-ring rounded"
          >
            Home
          </a>
        </li>
        <li aria-hidden="true">/</li>
        <li aria-current="page" class="text-text dark:text-text-dark">About</li>
      </ol>
    </nav>

    <!-- Page Title -->
    <h1
      class="font-display text-3xl md:text-4xl lg:text-5xl font-bold text-text dark:text-text-dark mb-8"
    >
      About Me
    </h1>

    <!-- Bio Section -->
    <section aria-labelledby="bio-heading" class="mb-16 md:mb-24">
      <h2 id="bio-heading" class="sr-only">Professional Bio</h2>

      <div class="flex flex-col md:flex-row gap-8 md:gap-12 items-start">
        <!-- Profile Image -->
        <div class="flex-shrink-0">
          <Image
            src={profileImage}
            alt="Cris Benge - Professional headshot"
            width={200}
            height={200}
            class="rounded-xl shadow-lg"
          />
        </div>

        <!-- Bio Text -->
        <div class="flex-1 prose prose-lg dark:prose-invert max-w-none">
          <p class="text-lg text-text dark:text-text-dark leading-relaxed">
            I'm <strong>Cris Benge</strong>, Head of Federal Innovation at
            Google, where I lead AI/ML initiatives that transform how government
            agencies leverage cutting-edge technology.
          </p>
          <p class="text-text-secondary dark:text-text-secondary-dark leading-relaxed mt-4">
            With over two decades of experience in software engineering and data
            science, I specialize in building scalable machine learning systems
            and driving innovation at the intersection of technology and public
            service. My work spans from developing computer vision solutions to
            architecting large-scale data pipelines.
          </p>
          <p class="text-text-secondary dark:text-text-secondary-dark leading-relaxed mt-4">
            I'm passionate about mentoring the next generation of technologists
            and contributing to open-source projects that advance the field of
            artificial intelligence.
          </p>
        </div>
      </div>
    </section>

    <!-- Education Section -->
    {
      hasEducation && (
        <section aria-labelledby="education-heading">
          <SectionHeading id="education-heading">
            Education
            <span slot="subtitle">
              Academic foundation in computer science, data science, and
              machine learning
            </span>
          </SectionHeading>

          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
            data-testid="education-grid"
          >
            {sortedEducation.map((edu) => (
              <EducationCard
                institution={edu.data.institution}
                degree={edu.data.degree}
                field={edu.data.field}
                year={edu.data.year}
                logoImage={edu.data.logoImage}
                institutionUrl={edu.data.institutionUrl}
                honors={edu.data.honors}
                data-reveal
              />
            ))}
          </div>
        </section>
      )
    }

    <!-- Certifications Section -->
    {
      hasCertifications && (
        <section aria-labelledby="certifications-heading" class="mt-16 md:mt-24">
          <SectionHeading id="certifications-heading">
            Certifications
            <span slot="subtitle">
              Professional credentials in cloud, data, and database technologies
            </span>
          </SectionHeading>

          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
            data-testid="certifications-grid"
          >
            {sortedCertifications.map((cert) => (
              <CertificationCard
                name={cert.data.name}
                issuer={cert.data.issuer}
                year={cert.data.year}
                category={cert.data.category}
                badgeUrl={cert.data.badgeUrl}
                verificationUrl={cert.data.verificationUrl}
                data-reveal
              />
            ))}
          </div>
        </section>
      )
    }

    <!-- Awards Section -->
    {
      hasAwards && (
        <section aria-labelledby="awards-heading" class="mt-16 md:mt-24">
          <SectionHeading id="awards-heading">
            Awards & Honors
            <span slot="subtitle">
              Competition achievements and professional recognition
            </span>
          </SectionHeading>

          {/* Competition Honors */}
          {competitionAwards.length > 0 && (
            <div class="mb-12">
              <h3 class="text-xl font-semibold text-text dark:text-text-dark mb-6">
                Competition Honors
              </h3>
              <div
                class="grid grid-cols-1 md:grid-cols-2 gap-6"
                data-testid="competition-awards-grid"
              >
                {competitionAwards.map((award) => (
                  <AwardCard
                    title={award.data.title}
                    year={award.data.year}
                    category={award.data.category}
                    description={award.data.description}
                    placement={award.data.placement}
                    organization={award.data.organization}
                    data-reveal
                  />
                ))}
              </div>
            </div>
          )}

          {/* Professional Awards */}
          {professionalAwards.length > 0 && (
            <div>
              <h3 class="text-xl font-semibold text-text dark:text-text-dark mb-6">
                Professional Recognition
              </h3>
              <div
                class="grid grid-cols-1 md:grid-cols-2 gap-6"
                data-testid="professional-awards-grid"
              >
                {professionalAwards.map((award) => (
                  <AwardCard
                    title={award.data.title}
                    year={award.data.year}
                    category={award.data.category}
                    description={award.data.description}
                    placement={award.data.placement}
                    organization={award.data.organization}
                    logoImage={award.data.logoImage}
                    data-reveal
                  />
                ))}
              </div>
            </div>
          )}
        </section>
      )
    }

    <!-- Empty state handled by conditional rendering above -->

    <!-- Contact Section -->
    <section class="mt-16 md:mt-24">
      <ContactSection showCV={false} data-reveal />
    </section>
  </div>

  <!-- Scroll reveal script -->
  <script>
    import '../scripts/scroll-reveal';
  </script>
</BaseLayout>
